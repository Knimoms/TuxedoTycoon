[gd_scene load_steps=28 format=2]

[ext_resource path="res://Scripts/BaseScript.cs" type="Script" id=1]
[ext_resource path="res://Scenes/FoodStallSpot.tscn" type="PackedScene" id=4]
[ext_resource path="res://Scripts/IsoCam.cs" type="Script" id=6]
[ext_resource path="res://Scenes/AdvertisingManager.tscn" type="PackedScene" id=7]
[ext_resource path="res://Scenes/CustomerSpawner.tscn" type="PackedScene" id=8]
[ext_resource path="res://Scenes/RecipeBook.tscn" type="PackedScene" id=9]
[ext_resource path="res://Scenes/TableSpot.tscn" type="PackedScene" id=12]

[sub_resource type="BoxShape" id=1]
extents = Vector3( 42, 0.001, 28 )

[sub_resource type="DynamicFontData" id=5]
font_path = "res://Assets/SansBlack.ttf"

[sub_resource type="DynamicFont" id=4]
size = 23
outline_color = Color( 0.0823529, 0.0745098, 0.0745098, 1 )
font_data = SubResource( 5 )

[sub_resource type="DynamicFont" id=6]
size = 23
font_data = SubResource( 5 )

[sub_resource type="DynamicFont" id=7]
size = 14
font_data = SubResource( 5 )

[sub_resource type="NavigationMesh" id=8]
vertices = PoolVector3Array( -0.875, 0.495, -4, 0.875, 0.495, -4, 1.125, 0.495, -7.25, -1.125, 0.495, -7.25, -6.625, 0.495, -18.25, -6.625, 0.495, -7.25, -5.125, 0.495, -8.75, -5.375, 0.495, -18.25, 2.625, 0.495, -9, 2.625, 0.495, -18.25, 1.375, 0.495, -18.25, 1.375, 0.495, -9, -5.125, 0.495, -8.75, -6.625, 0.495, -7.25, -1.125, 0.495, -7.25, -1.375, 0.495, -9, -2.625, 0.495, -9, 5.125, 0.495, -8.75, 2.625, 0.495, -9, 1.375, 0.495, -9, 5.125, 0.495, -8.75, 1.375, 0.495, -9, -1.375, 0.495, -9, 1.125, 0.495, -7.25, 6.625, 0.495, -7.25, -1.375, 0.495, -9, -1.375, 0.495, -18.25, -2.625, 0.495, -18.25, -2.625, 0.495, -9, -1.125, 0.495, -7.25, 1.125, 0.495, -7.25, -1.375, 0.495, -9, 6.625, 0.495, -18.25, 5.375, 0.495, -18.25, 5.125, 0.495, -8.75, 6.625, 0.495, -7.25, 1.375, 0.495, -3.75, 0.875, 0.495, -4, -0.875, 0.495, -4, -0.875, 0.495, -1, 0.875, 0.495, -1, 1.125, 0.495, -2.25, -1.125, 0.495, -2.25, 6.375, 0.495, -4.75, 1.625, 0.495, -4.75, 1.375, 0.495, -3.75, 1.125, 0.495, -2.25, 1.625, 0.495, -1.5, 6.375, 0.495, -1.5, 1.375, 0.495, -3.75, -0.875, 0.495, -4, -1.625, 0.495, -4, -1.125, 0.495, -2.25, 1.125, 0.495, -2.25, 6.375, 0.495, -1.5, 6.625, 0.495, -4, 6.375, 0.495, -4.75, -6.375, 0.495, -4.75, -6.625, 0.495, -4, -6.375, 0.495, -1.5, -1.625, 0.495, -1.5, -1.125, 0.495, -2.25, -1.625, 0.495, -4, -1.625, 0.495, -4, -1.625, 0.495, -4.75, -6.375, 0.495, -4.75, -1.125, 0.495, 1.75, -0.875, 0.495, 3, 0.875, 0.495, 3, 1.125, 0.495, 1.75, 1.125, 0.495, 0.25, -1.125, 0.495, 0.25, -1.125, 0.495, 1.75, -1.125, 0.495, 0.25, -1.625, 0.495, -0.5, -6.375, 0.495, -0.5, -6.375, 0.495, 2.5, -1.625, 0.495, 2.5, 1.125, 0.495, 0.25, 0.875, 0.495, -1, -0.875, 0.495, -1, -1.125, 0.495, 0.25, 1.125, 0.495, 0.25, 1.125, 0.495, 1.75, 1.625, 0.495, 2.5, 6.375, 0.495, 2.5, 6.375, 0.495, -0.5, 1.625, 0.495, -0.5, 6.375, 0.495, 2.5, 6.625, 0.495, 0, 6.375, 0.495, -0.5, -6.375, 0.495, -0.5, -6.625, 0.495, 0, -6.375, 0.495, 2.5, 0.875, 0.495, 3, -0.875, 0.495, 3, -1.125, 0.495, 4.25, 1.125, 0.495, 4.25, -6.375, 0.495, 6.75, -1.625, 0.495, 6.75, -1.375, 0.495, 5.75, -1.125, 0.495, 4.25, -1.625, 0.495, 3.5, -6.375, 0.495, 3.5, -0.875, 0.495, 6, -0.875, 0.495, 7.75, 0.875, 0.495, 7.75, 1.125, 0.495, 5.75, 6.375, 0.495, 3.5, 1.625, 0.495, 3.5, 1.125, 0.495, 4.25, 1.125, 0.495, 5.75, 1.625, 0.495, 6, 6.375, 0.495, 6.75, -1.375, 0.495, 5.75, -0.875, 0.495, 6, 1.125, 0.495, 5.75, 1.125, 0.495, 4.25, -1.125, 0.495, 4.25, 1.625, 0.495, 6, 1.625, 0.495, 6.75, 6.375, 0.495, 6.75 )
polygons = [ PoolIntArray( 0, 3, 1 ), PoolIntArray( 1, 3, 2 ), PoolIntArray( 7, 6, 4 ), PoolIntArray( 4, 6, 5 ), PoolIntArray( 11, 10, 8 ), PoolIntArray( 8, 10, 9 ), PoolIntArray( 15, 14, 16 ), PoolIntArray( 16, 14, 12 ), PoolIntArray( 12, 14, 13 ), PoolIntArray( 19, 18, 17 ), PoolIntArray( 22, 21, 23 ), PoolIntArray( 23, 21, 20 ), PoolIntArray( 23, 20, 24 ), PoolIntArray( 28, 27, 25 ), PoolIntArray( 25, 27, 26 ), PoolIntArray( 31, 30, 29 ), PoolIntArray( 33, 32, 34 ), PoolIntArray( 34, 32, 35 ), PoolIntArray( 38, 37, 36 ), PoolIntArray( 39, 42, 40 ), PoolIntArray( 40, 42, 41 ), PoolIntArray( 46, 45, 47 ), PoolIntArray( 47, 45, 44 ), PoolIntArray( 47, 44, 43 ), PoolIntArray( 47, 43, 48 ), PoolIntArray( 51, 50, 52 ), PoolIntArray( 52, 50, 53 ), PoolIntArray( 53, 50, 49 ), PoolIntArray( 56, 55, 54 ), PoolIntArray( 61, 60, 62 ), PoolIntArray( 62, 60, 59 ), PoolIntArray( 62, 59, 58 ), PoolIntArray( 62, 58, 57 ), PoolIntArray( 65, 64, 63 ), PoolIntArray( 67, 66, 68 ), PoolIntArray( 68, 66, 69 ), PoolIntArray( 69, 66, 71 ), PoolIntArray( 69, 71, 70 ), PoolIntArray( 72, 77, 73 ), PoolIntArray( 73, 77, 74 ), PoolIntArray( 74, 77, 76 ), PoolIntArray( 74, 76, 75 ), PoolIntArray( 79, 78, 80 ), PoolIntArray( 80, 78, 81 ), PoolIntArray( 82, 87, 83 ), PoolIntArray( 83, 87, 84 ), PoolIntArray( 84, 87, 86 ), PoolIntArray( 84, 86, 85 ), PoolIntArray( 90, 89, 88 ), PoolIntArray( 91, 93, 92 ), PoolIntArray( 94, 97, 95 ), PoolIntArray( 95, 97, 96 ), PoolIntArray( 101, 100, 102 ), PoolIntArray( 102, 100, 99 ), PoolIntArray( 102, 99, 98 ), PoolIntArray( 102, 98, 103 ), PoolIntArray( 105, 104, 106 ), PoolIntArray( 106, 104, 107 ), PoolIntArray( 111, 110, 112 ), PoolIntArray( 112, 110, 109 ), PoolIntArray( 112, 109, 108 ), PoolIntArray( 112, 108, 113 ), PoolIntArray( 114, 118, 115 ), PoolIntArray( 115, 118, 116 ), PoolIntArray( 116, 118, 117 ), PoolIntArray( 121, 120, 119 ) ]
geometry_parsed_geometry_type = 2
agent_height = 0.5
agent_radius = 0.1
agent_max_climb = 0.0

[sub_resource type="PlaneMesh" id=9]
size = Vector2( 2, 16 )

[sub_resource type="PlaneMesh" id=10]
size = Vector2( 13.75, 2 )

[sub_resource type="PlaneMesh" id=11]
size = Vector2( 1.6, 11 )

[sub_resource type="PlaneMesh" id=12]
size = Vector2( 13.75, 2 )

[sub_resource type="PlaneMesh" id=13]
size = Vector2( 5, 12 )

[sub_resource type="PlaneMesh" id=14]
size = Vector2( 64, 64 )
subdivide_width = 16
subdivide_depth = 16

[sub_resource type="Shader" id=15]
code = "shader_type spatial;

render_mode blend_mix, specular_phong;

uniform float speed : hint_range(-1,1) = 0.0;

//colors
uniform sampler2D noise1; //add Godot noise here
uniform sampler2D noise2; //add Godot noise here
uniform sampler2D normalmap : hint_normal; //add Godot noise here, enable as_normalmap
uniform vec4 color : hint_color;
uniform vec4 edge_color : hint_color;

//foam
uniform float edge_scale = 0.25;
uniform float near = 0.1;
uniform float far = 100;

//waves
uniform vec2 wave_strengh = vec2(0.5, 0.25);
uniform vec2 wave_frequency = vec2(12.0, 12.0);
uniform vec2 time_factor = vec2(1.0, 2.0);

float rim(float depth){
	depth = 2.0f * depth - 1.0f;
	return near * far / (far + depth * (near - far));
}


float waves(vec2 pos, float time){
	return (wave_strengh.y * sin(pos.y * wave_frequency.y + time * time_factor.y)) + (wave_strengh.x * sin(pos.x * wave_frequency.x + time * time_factor.x));
}


void vertex(){
	VERTEX.y += waves(VERTEX.xy, TIME);
}


void fragment(){
	float time = TIME * speed;
	vec3 n1 = texture(noise1, UV + time).rgb;
	vec3 n2 = texture(noise2, UV - time * 0.2).rgb;
	
	vec2 uv_movement = UV * 4.0f;
	uv_movement += TIME * speed * 4.0f;
	
	float sum = (n1.r + n2.r) - 1.0f;
	
	
	float z_depth = rim(texture(DEPTH_TEXTURE, SCREEN_UV).x);
	float z_pos = rim(FRAGCOORD.z);
	float diff = z_depth - z_pos;
	
	vec2 displacement = vec2(sum * 0.05);
	diff += displacement.x * 50.0f;
	
	
	vec4 col = mix(edge_color, color, step(edge_scale, diff));
	
	vec4 alpha = vec4(1.0);
	alpha = texture(SCREEN_TEXTURE, SCREEN_UV + displacement);
	
	
	float fin = 0.0;
	if (sum > 0.0 && sum < 0.4) fin = 0.1;
	if (sum > 0.4 && sum < 0.8) fin = 0.0;
	if (sum > 0.8) fin = 1.0f;
	
	ALBEDO = vec3(fin) + mix(alpha.rgb, col.rgb, color.a);
	
	NORMALMAP = texture(normalmap, uv_movement).rgb;
	ROUGHNESS = 0.1;
	SPECULAR = 1.0f;
}"

[sub_resource type="OpenSimplexNoise" id=17]
lacunarity = 4.0

[sub_resource type="NoiseTexture" id=18]
seamless = true
noise = SubResource( 17 )

[sub_resource type="OpenSimplexNoise" id=19]

[sub_resource type="NoiseTexture" id=20]
seamless = true
noise = SubResource( 19 )

[sub_resource type="OpenSimplexNoise" id=21]

[sub_resource type="NoiseTexture" id=22]
seamless = true
as_normalmap = true
bump_strength = 4.0
noise = SubResource( 21 )

[sub_resource type="ShaderMaterial" id=16]
shader = SubResource( 15 )
shader_param/speed = 0.02
shader_param/color = Color( 0.0392157, 0.694118, 1, 1 )
shader_param/edge_color = Color( 1, 1, 1, 1 )
shader_param/edge_scale = 0.25
shader_param/near = 0.1
shader_param/far = 100.0
shader_param/wave_strengh = Vector2( 0.5, 0.25 )
shader_param/wave_frequency = Vector2( 12, 12 )
shader_param/time_factor = Vector2( 1, 2 )
shader_param/noise1 = SubResource( 18 )
shader_param/noise2 = SubResource( 20 )
shader_param/normalmap = SubResource( 22 )

[node name="Spatial" type="Spatial"]
script = ExtResource( 1 )
StartMoneyValue = 800.0
StartMoneyMagnitude = "a"

[node name="pivot" type="Spatial" parent="."]
script = ExtResource( 6 )

[node name="Camera" type="Camera" parent="pivot"]
transform = Transform( 1, 0, 0, 0, 0.707107, 0.707107, 0, -0.707107, 0.707107, 0, 100, 100 )
projection = 1
current = true
fov = 29.5
size = 20.0
far = 175.0

[node name="Spatial" type="Spatial" parent="."]
transform = Transform( 0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, 0, 0, 0 )

[node name="Floor" type="CSGBox" parent="."]
transform = Transform( 0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, 0, 0, 0 )
visible = false
width = 42.0
height = 0.001
depth = 35.0

[node name="StaticBody" type="StaticBody" parent="Floor"]

[node name="CollisionShape" type="CollisionShape" parent="Floor/StaticBody"]
shape = SubResource( 1 )

[node name="MoneyLabel" type="Label" parent="."]
anchor_left = 0.03125
anchor_top = 0.00166667
anchor_right = 0.222656
anchor_bottom = 0.183334
custom_fonts/font = SubResource( 4 )
text = "ghfghfgh"
__meta__ = {
"_edit_use_anchors_": true
}

[node name="Button" type="Button" parent="."]
anchor_left = 0.786133
anchor_top = 0.833333
anchor_right = 0.973633
anchor_bottom = 0.993333
size_flags_horizontal = 3
size_flags_vertical = 3
custom_fonts/font = SubResource( 4 )
text = "Build"
__meta__ = {
"_edit_use_anchors_": true
}

[node name="MaxInputDelay" type="Timer" parent="."]
wait_time = 0.2
one_shot = true

[node name="Upgrade" type="Button" parent="."]
visible = false
anchor_left = 0.0282189
anchor_top = 0.0540541
anchor_right = 0.185445
anchor_bottom = 0.205721
margin_left = 831.104
margin_top = -24.4324
margin_right = 831.104
margin_bottom = -24.4324
__meta__ = {
"_edit_use_anchors_": true
}

[node name="AdManager" parent="." instance=ExtResource( 7 )]
NewspaperCostValue = 10.0
NewspaperCostMagnitude = "a"

[node name="Spawner" parent="." instance=ExtResource( 8 )]

[node name="AdvertisementButton" type="Button" parent="."]
visible = false
anchor_left = 0.0244141
anchor_top = 0.833333
anchor_right = 0.211914
anchor_bottom = 0.993333
size_flags_horizontal = 3
size_flags_vertical = 3
custom_fonts/font = SubResource( 6 )
text = "Advertisement"
__meta__ = {
"_edit_use_anchors_": true
}

[node name="AverageSatisfaction" type="Label" parent="."]
anchor_left = 0.662109
anchor_top = 0.01
anchor_right = 0.853515
anchor_bottom = 0.191668
custom_fonts/font = SubResource( 4 )
text = "Rating: no data "
align = 2
__meta__ = {
"_edit_use_anchors_": true
}

[node name="RecipeButton" type="Button" parent="."]
margin_left = 946.0
margin_top = 4.0
margin_right = 1021.0
margin_bottom = 49.0
custom_fonts/font = SubResource( 7 )
text = "Recipes"

[node name="NavigationMeshInstance" type="NavigationMeshInstance" parent="."]
transform = Transform( 0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, 4.24264, 0, 4.24264 )
navmesh = SubResource( 8 )

[node name="MeshInstance" type="MeshInstance" parent="NavigationMeshInstance"]
mesh = SubResource( 9 )
skeleton = NodePath("../..")

[node name="MeshInstance2" type="MeshInstance" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -8 )
mesh = SubResource( 10 )

[node name="MeshInstance3" type="MeshInstance" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -6, 0, -13 )
mesh = SubResource( 11 )

[node name="MeshInstance4" type="MeshInstance" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -2, 0, -13 )
mesh = SubResource( 11 )

[node name="MeshInstance5" type="MeshInstance" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 2, 0, -13 )
mesh = SubResource( 11 )

[node name="MeshInstance6" type="MeshInstance" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 6, 0, -13 )
mesh = SubResource( 11 )

[node name="MeshInstance7" type="MeshInstance" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 5 )
mesh = SubResource( 12 )

[node name="MeshInstance8" type="MeshInstance" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1 )
mesh = SubResource( 12 )

[node name="MeshInstance9" type="MeshInstance" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -3 )
mesh = SubResource( 12 )

[node name="MeshInstance10" type="MeshInstance" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 4, 0, 1 )
mesh = SubResource( 13 )

[node name="MeshInstance11" type="MeshInstance" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4, 0, 1 )
mesh = SubResource( 13 )

[node name="Wall" type="CSGBox" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4, 1, -1 )
visible = false
width = 5.0
depth = 0.1

[node name="Wall2" type="CSGBox" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4, 1, 3 )
visible = false
width = 5.0
depth = 0.1

[node name="Wall3" type="CSGBox" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 4, 1, -1 )
visible = false
width = 5.0
depth = 0.1

[node name="Wall4" type="CSGBox" parent="NavigationMeshInstance"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 4, 1, 3 )
visible = false
width = 5.0
depth = 0.1

[node name="TableSpot" parent="NavigationMeshInstance" instance=ExtResource( 12 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4, 0, -3 )

[node name="TableSpot2" parent="NavigationMeshInstance" instance=ExtResource( 12 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4, 0, 1 )

[node name="TableSpot3" parent="NavigationMeshInstance" instance=ExtResource( 12 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4, 0, 5 )

[node name="TableSpot4" parent="NavigationMeshInstance" instance=ExtResource( 12 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 4, 0, -3 )

[node name="TableSpot5" parent="NavigationMeshInstance" instance=ExtResource( 12 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 4, 0, 1 )

[node name="TableSpot6" parent="NavigationMeshInstance" instance=ExtResource( 12 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 4, 0, 5 )

[node name="Floor2" type="CSGBox" parent="."]
transform = Transform( 0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, 0, 0, 0 )
width = 14.0
height = 0.001
depth = 28.0

[node name="FoodStallSpot" parent="." instance=ExtResource( 4 )]
transform = Transform( 0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, -13.435, 0, -4.94975 )

[node name="FoodStallSpot2" parent="." instance=ExtResource( 4 )]
transform = Transform( 0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, -10.6066, 0, -7.77817 )

[node name="FoodStallSpot3" parent="." instance=ExtResource( 4 )]
transform = Transform( 0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, -7.77817, 0, -10.6066 )

[node name="FoodStallSpot4" parent="." instance=ExtResource( 4 )]
transform = Transform( 0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, -4.94975, 0, -13.435 )

[node name="SpawnPoint" type="Spatial" parent="."]
transform = Transform( 0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, 8.55588, 0.5, 8.58057 )

[node name="RecipeBook" parent="." instance=ExtResource( 9 )]

[node name="Water" type="MeshInstance" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.27702, -3.43046, 1.02232 )
mesh = SubResource( 14 )
material/0 = SubResource( 16 )

[node name="DirectionalLight" type="DirectionalLight" parent="."]
transform = Transform( 1, 0, 0, 0, 0.892783, 0.450488, 0, -0.450488, 0.892783, -4.31201, 8.01253, 6.17821 )
light_energy = 0.5

[node name="CPMLabel" type="Label" parent="."]
anchor_left = 0.662109
anchor_top = 0.01
anchor_right = 0.853515
anchor_bottom = 0.191668
margin_left = -353.0
margin_right = -353.0
custom_fonts/font = SubResource( 4 )
text = "CPM"
align = 1
__meta__ = {
"_edit_use_anchors_": true
}

[connection signal="pressed" from="Button" to="." method="_on_Button_pressed"]
[connection signal="pressed" from="AdvertisementButton" to="." method="_on_AdvertisementButton_pressed"]
[connection signal="pressed" from="RecipeButton" to="." method="_on_RecipeButton_pressed"]
[connection signal="popup_hide" from="RecipeBook" to="." method="_on_RecipeBook_popup_hide"]
